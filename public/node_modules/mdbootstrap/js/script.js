$(document).ready(function () {

    setTimeout(function () {
        var table = $('.DataFromDB').DataTable({
            dom: 'lBfrtip',
             "pagingType": "full_numbers",
             buttons: [
            {
                extend: 'print',
                exportOptions: {
                     columns: ':visible',
                    stripHtml:false
                }
            },
             {
                 extend: 'csv',
                 exportOptions: {
                     columns: ':visible',
                       stripHtml:false
                 }
            },{
                 extend: 'excel',
                 exportOptions: {
                     columns: ':visible',
                       stripHtml:false
                 }
            },
             {
                 extend: 'pdf',
                 exportOptions: {
                     columns: ':visible',
                       stripHtml:false
                 }
                 },
             {
                 extend: 'copy',
                 exportOptions: {
                     columns: ':visible',
                       stripHtml:false
                 }
            },
             'colvis'
             ]
    });
    $('.dt-button').addClass("btn btn-elegant waves-effect btn-sm"); // add styling
        
        $('.buttons-collection').click(function () {
            let visibleBtn = $('.dt-button-collection')[0];
            visibleBtn.style.marginTop = "1rem";
            $('.buttons-columnVisibility').addClass('btn btn-info btn-sm');
        });

    }, 4000);

        
    const viewForm = $('#view')[0];
    const viewFormData = new FormData(viewForm);
    //global initial state
    const form = $('#formAdd')[0];
    const formData = new FormData(form);
    const s = document.querySelector('#s');
    $('.dropify').dropify();

    $('#resetForm').click(function (e) {
        e.preventDefault();
        form.reset();
        s.value = -1;
        dropifyReset();
             
    });
    //list view
    $('#listView').click(function (e) {
        e.preventDefault();
        getDataByView();
        $('#staffResult').empty();

    });
    //grid view
    $('#gridView').click(function (e) {
        e.preventDefault();
        getDataByView('grid', 'staffs', 'staffResult');
        $('#result').empty();
    });
    /*SIMPLE VALIDATION*/
    //letters space and numbers only
    $('.input').keypress(function () {
        return /[0-9a-zA-Z. ]/i.test(event.key);
    });
    $('#saveAttendance').click(function () {
        //
        
         $('#dateSet')[0].value = $('#subjectAttendanceDate')[0].value;
            const form = $('#formAttendance')[0];
            const formData = new FormData(form);
            $.ajax({
                url: `./components/subjectAttendanceComponent.php`,
                type: 'POST',
                data: formData,
                contentType: false,
                cache: false,
                processData: false,
                success: (response) => {
                    $('#msg').html(response);
                    getData("subjectAttendance");
                }
            });
    });

    //getDatabyView init for staffs
    getDataByView();
    //YEAR
    getDataByView('list', 'year', 'yearResult');
    //SECTIONS
    getDataByView('list', 'sections', 'sectionResult');
    //COURSES
    getDataByView('list', 'courses', 'courseResult');
    //SUBJECTS
    getDataByView('list', 'subjects', 'subjectResult');
    //STUDENTS
    getDataByView('list', 'students', 'studentResult');
    //AccountsS
    getDataByView('list', 'accounts', 'accountResult');
    // Professors Subject List
    getDataByView('list', 'professorSubjectList', 'pResult');
    // Students Subject List
    getDataByView('list', 'enrolledSubjects', 'enrolledSubjectResult');
    // Guard Attendance
    getDataByView('list', 'guardAttendance', 'guardAttendanceResult');

    getDataByView('list', 'notifications', 'notificationResult');
    getDataByView('list', 'appointments', 'appointmentResult');


  let reloadID=null;
    $('#realTime').click(function () {
        let realTime = document.getElementById('realTime');
        if (realTime.value==0) {
              realTime.value = 1;
            reloadID = setInterval(function () {
               getDataByView('list', 'guardAttendance', 'guardAttendanceResult')
            }
            , 5000);

        } else {
        realTime.value = 0;
        clearInterval(reloadID);
        }
    });

    $('button').click(function (e) {
        e.preventDefault();
    });
    //showpassword
    let hidden = true;
    let pwd = document.getElementById('pwd');
    $('#visiblePwd').click(function () {
        if (hidden) {
            $('#visiblePwd').removeClass('far fa-eye-slash');
            $('#visiblePwd').addClass('far fa-eye');
            pwd.type = "text";
            hidden = false;
            
        } else {
              $('#visiblePwd').removeClass('far fa-eye');
            $('#visiblePwd').addClass('far fa-eye-slash');
            pwd.type = "password";
            hidden = true;
        }
    });

    // $(document).click(function (e) {
    //     console.log(e.target);
    // });

    $('#today').click(function () {
        let today = document.getElementById('today');
        let off = today.value;
        if (off==0) {
            today.value = 1;
        } else {
            today.value = 0;
        } 
            $.ajax({
                url: `./data/guardAttendance.php`,
                type: 'POST',
                data: {
                    'today': today.value
                },
                success: (response) => {
                    $(`#guardAttendanceResult`).html(response);
                }
            });
    });

    // Data Picker Initialization
// $('.datepicker').datepicker();
    
    
    // SIDEBAR
    $(".sidebar-dropdown > a").click(function() {
  $(".sidebar-submenu").slideUp(200);
  if (
    $(this)
      .parent()
      .hasClass("active")
  ) {
    $(".sidebar-dropdown").removeClass("active");
    $(this)
      .parent()
      .removeClass("active");
  } else {
    $(".sidebar-dropdown").removeClass("active");
    $(this)
      .next(".sidebar-submenu")
      .slideDown(200);
    $(this)
      .parent()
      .addClass("active");
  }
    });

    $("#close-sidebar").click(function() {
    $(".page-wrapper").removeClass("toggled");
    });
    $("#show-sidebar").click(function() {
    $(".page-wrapper").addClass("toggled");
    });

    
});

